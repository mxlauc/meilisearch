# Create or update a latest git tag when releasing a stable version of Meilisearch
name: Update latest git tag
on:
  push:
    branches: [ main2 ]


jobs:
  check-version:
    name: Check the version validity
    runs-on: ubuntu-latest
    env:
        ACTIONS_RUNNER_FORCE_ACTIONS_NODE_VERSION: node16
        ACTIONS_ALLOW_USE_UNSECURE_NODE_VERSION: true
    container: centos:7
    steps:
      - name: ðŸšš Get latest code
        uses: actions/checkout@v3
        
      - name: Install essential
        run: |
          wget http://ftp.gnu.org/gnu/gcc/gcc-9.2.0/gcc-9.2.0.tar.gz
          tar xf gcc-9.2.0.tar.gz
          cd gcc-9.2.0
          ./configure --disable-multilib --enable-languages=c,c++
          make -j$(nproc)
          sudo make install

      
      - name: Install cargo
        uses: actions-rs/toolchain@v1
        with:
            toolchain: nightly
            override: true
            components: rustfmt, clippy
      - name: Compiling
        uses: actions-rs/cargo@v1
        with:
          command: build
          args: --release
